services:
  worker:
    build:
      context: .
      dockerfile: apps/worker/Dockerfile
    ports:
      - "4000:4000"
    environment:
      PORT: "4000"
      DB_DIALECT: "sqlite"
      SQLITE_PATH: "/data/data.db"
      ARK_API_KEY: "${ARK_API_KEY}"
      ARK_BASE_URL: "${ARK_BASE_URL:-https://ark.cn-beijing.volces.com/api/v3}"
      ARK_MODEL: "${ARK_MODEL:-doubao-seed-1-8-251228}"
    volumes:
      - biaozhu_data:/data
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
    ports:
      - "3000:3000"
    environment:
      NEXT_PUBLIC_WORKER_URL: "${NEXT_PUBLIC_WORKER_URL:-http://localhost:4000}"
    depends_on:
      - worker
    restart: unless-stopped

volumes:
  biaozhu_data:
